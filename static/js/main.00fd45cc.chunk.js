(this["webpackJsonpreact-app-game-of-life"]=this["webpackJsonpreact-app-game-of-life"]||[]).push([[0],{15:function(e,t,n){},16:function(e,t,n){},29:function(e,t,n){"use strict";n.r(t);var s=n(1),i=n.n(s),a=n(8),r=n.n(a),c=(n(14),n(15),n(16),n(0)),o=n(9);class l{}class u{constructor(e,t){this.X=e,this.Y=t}}const h=e=>{e.preventDefault();if(e.currentTarget.getContext("2d")){const{x:t,y:n}=(e=>{const t=e.currentTarget.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}})(e);console.log("leftClick @ { x: ".concat(t,", y: ").concat(n," }"));const s=c.EntityManager.instance.createEntity();s.add(new u(t,n)),s.add(new l)}};class y{}const d=e=>{e.preventDefault();if(e.currentTarget.getContext("2d")){const{x:t,y:n}=(e=>{const t=e.currentTarget.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}})(e);console.log("click @ { x: ".concat(t,", y: ").concat(n," }"));const s=c.EntityManager.instance.createEntity();s.add(new u(t,n)),s.add(new y)}};const g=e=>{e.width=window.innerWidth,e.height=window.innerHeight};class f{constructor(e){this.Context=e}}var x=n(2);const p=function(){var e,t;const n=Object(s.useRef)(null),i=Object(s.useCallback)((e=>{h(e)}),[]),{startPan:a}=Object(o.a)(n,null===(e=n.current)||void 0===e?void 0:e.width,null===(t=n.current)||void 0===t?void 0:t.height);return Object(s.useEffect)((()=>{const e=n.current;return null===e||void 0===e||e.addEventListener("contextmenu",i),()=>{null===e||void 0===e||e.removeEventListener("contextmenu",i)}}),[n,i]),Object(s.useEffect)((()=>{null!==n.current&&g(n.current)}),[n]),Object(s.useEffect)((()=>{var e;const t=null===(e=n.current)||void 0===e?void 0:e.getContext("2d");t&&(e=>{const t=c.EntityManager.instance.createEntity();t.add(new f(e)),c.EntityManager.instance.addEntity(t)})(t)}),[]),Object(x.jsx)("canvas",{ref:n,onClick:e=>d(e),onMouseDown:e=>{1===e.button&&a(e)}})};class Q{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this.Width=e,this.Height=t,this.CellSize=n,this.Cells=s}}class v{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Value=e}}class m extends c.BaseSystem{constructor(){super(...arguments),this.gridQuery=new c.Query((e=>e.has(Q)),this.entityManager),this.canvasQuery=new c.Query((e=>e.has(f)),this.entityManager)}onRender(){const e=this.canvasQuery.find(),t=this.gridQuery.find();if(!e||!t)return;const n=e.get(f).Context,s=n.getTransform();n.canvas.width=e.get(f).Context.canvas.width,n.setTransform(s)}}class w{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Value=e}}class E extends c.BaseSystem{constructor(){super(...arguments),this.q=new c.Query((e=>e.has(u)&&e.has(w))),this.gridQuery=new c.Query((e=>e.has(Q)),this.entityManager),this.canvasQuery=new c.Query((e=>e.has(f)))}onRender(){const e=this.canvasQuery.find(),t=this.gridQuery.find();if(!e||!t)return;const n=t.get(Q).CellSize;this.q.foreach((t=>{const s=t.get(u),i=t.get(w),a=s.X*n,r=s.Y*n;if(i.Value){const t=e.get(f).Context;t.fillStyle="black",t.fillRect(a,r,n,n)}}))}}class b extends c.BaseSystem{constructor(){super(),this.gridQuery=new c.Query((e=>e.has(Q)),this.entityManager),this.canvasQuery=new c.Query((e=>e.has(f)),this.entityManager),this.cellsQuery=new c.Query((e=>e.has(u)),this.entityManager)}onCreate(){const e=this.canvasQuery.find(),t=this.gridQuery.find();if(!e||!t)return void c.Engine.instance.unregisterSystem(this);const n=e.get(f).Context,s=t.get(Q);n.strokeStyle="#c0c0c0",n.lineWidth=.03;for(let i=0;i<s.Width/s.CellSize;i+=1)for(let e=0;e<s.Height/s.CellSize;e+=1){const t=this.entityManager.createEntity();t.add(new u(i,e)),t.add(new w),s.Cells[i+e*s.Width]=t}}onRender(){const e=this.canvasQuery.find(),t=this.gridQuery.find();if(!e||!t)return;const n=e.get(f).Context,s=t.get(Q);this.cellsQuery.foreach((e=>{const t=e.get(u);n.strokeStyle="#c0c0c0",n.lineWidth=.03,n.strokeRect(t.X*s.CellSize,t.Y*s.CellSize,s.CellSize,s.CellSize)}),this.entityManager.entities)}}class C extends c.BaseSystem{constructor(){super(...arguments),this.gridQuery=new c.Query((e=>e.has(Q)),this.entityManager),this.canvasQuery=new c.Query((e=>e.has(f)),this.entityManager),this.activateCellsQuery=new c.Query((e=>e.has(y)&&e.has(u)),this.entityManager),this.cellQuery=new c.Query((e=>e.has(w)),this.entityManager)}onUpdate(){const e=this.canvasQuery.find(),t=this.gridQuery.find();if(!e||!t)return;const n=[];this.activateCellsQuery.foreach((s=>{const i=s.get(u),a=t.get(Q),r=e.get(f);if(i&&a&&r){const e=Math.floor(i.X/a.CellSize),t=Math.floor(i.Y/a.CellSize);i.X=e,i.Y=t,n.push(i),this.entityManager.removeEntity(s.id)}})),n.length>0&&this.cellQuery.foreach((e=>{const t=e.get(u);n.some((e=>e.X===t.X&&e.Y===t.Y))&&e.add(new w(1))}))}}class j extends c.BaseSystem{constructor(){super(...arguments),this.gridQuery=new c.Query((e=>e.has(Q)),this.entityManager),this.canvasQuery=new c.Query((e=>e.has(f)),this.entityManager),this.deactivateCellsQuery=new c.Query((e=>e.has(l)),this.entityManager),this.cellQuery=new c.Query((e=>e.has(w)),this.entityManager)}onUpdate(){const e=this.canvasQuery.find(),t=this.gridQuery.find();if(!e||!t)return;const n=[];this.deactivateCellsQuery.foreach((s=>{const i=s.get(u),a=t.get(Q),r=e.get(f);if(i&&a&&r){const e=Math.floor(i.X/a.CellSize),t=Math.floor(i.Y/a.CellSize);i.X=e,i.Y=t,n.push(i),this.entityManager.removeEntity(s.id)}})),n.length>0&&this.cellQuery.foreach((e=>{const t=e.get(u);n.some((e=>e.X===t.X&&e.Y===t.Y))&&e.add(new w(0))}))}}class M extends v{constructor(){super(...arguments),this.speedMultiplier=1}}const S=new class{constructor(){this.all=[{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:-1,y:0},{x:1,y:0},{x:-1,y:1},{x:0,y:1},{x:1,y:1}],this.diagonals=[{x:-1,y:-1},{x:1,y:-1},{x:-1,y:1},{x:1,y:1}],this.adjacent=[{x:0,y:-1},{x:-1,y:0},{x:1,y:0},{x:0,y:1}],this.allWithThis=[{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:-1,y:1},{x:0,y:1},{x:1,y:1}]}getAllNeighbors(e,t){return this.all.map((n=>({x:e+n.x,y:t+n.y})))}};class O extends c.BaseSystem{constructor(){super(...arguments),this.lastUpdate=0,this.activeCells=new c.Query((e=>e.has(w)&&e.has(u)),this.entityManager),this.time=new c.Query((e=>e.has(M))),this.gridQuery=new c.Query((e=>e.has(Q)))}onUpdate(){const e=this.time.find();if(!e)return;const t=e.get(M).Value,{speedMultiplier:n}=e.get(M);this.lastUpdate+100/n<t&&(this.activeCells.foreach((e=>{const{X:t,Y:n}=e.get(u),s=S.getAllNeighbors(t,n);let i=0;const a=this.gridQuery.find();s.forEach((e=>{let{x:t,y:n}=e;if(a){const e=a.get(Q).Width,s=a.get(Q).Cells[t+n*e];s&&1===s.get(w).Value&&(i+=1)}})),(i<2||i>3)&&(e.get(w).Value=0),3===i&&(e.get(w).Value=1)})),this.lastUpdate=t)}}class k extends c.BaseSystem{constructor(){super(),this.q=void 0,this.q=new c.Query((e=>e.has(v)))}onUpdate(e){this.q.foreach((t=>{t.get(v).Value=e+1}))}}const T=e=>{const t=i.a.useRef(0),n=i.a.useRef(0),a=Object(s.useCallback)((s=>{const i=s-n.current;e(i),t.current=requestAnimationFrame(a),n.current=s}),[e]);Object(s.useEffect)((()=>(t.current=requestAnimationFrame(a),()=>cancelAnimationFrame(t.current))),[a])};const X=(e,t)=>{const n=i.a.useRef(),a=i.a.useRef(0),r=Object(s.useCallback)((()=>{const s=Date.now(),i=s-a.current;e(i),n.current=setTimeout(r,t),a.current=s}),[e,t]);Object(s.useEffect)((()=>(n.current=setTimeout(r,t),()=>n.current&&clearTimeout(n.current))),[t,r])};class Y{}class B{}class z{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.speedMultiplier=e}}class R extends c.BaseSystem{constructor(){super(...arguments),this.q=new c.Query((e=>e.has(M))),this.pausedQ=new c.Query((e=>e.has(Y))),this.playQ=new c.Query((e=>e.has(B))),this.speedMultiplierQ=new c.Query((e=>e.has(z)))}onCreate(){this.entityManager.createEntity().addComponent(new M(0))}onUpdate(){this.q.foreach((e=>{const t=e.get(M),n=this.pausedQ.find(),s=this.playQ.find(),i=this.speedMultiplierQ.find();i&&(t.speedMultiplier=i?i.get(z).speedMultiplier:1,this.entityManager.removeEntity(i.id)),n&&!s||(n&&(this.pausedQ.foreach((e=>{this.entityManager.removeEntity(e.id)})),this.playQ.foreach((e=>{this.entityManager.removeEntity(e.id)}))),t.Value=performance.now())}))}}class U{}class V extends c.BaseSystem{constructor(){super(...arguments),this.lastUpdate=0,this.activeCells=new c.Query((e=>e.has(w)&&e.has(u)),this.entityManager),this.clearQ=new c.Query((e=>e.has(U)))}onUpdate(){const e=this.clearQ.find();e&&(this.activeCells.foreach((e=>{e.get(w).Value=0})),this.entityManager.removeEntity(e.id))}}const q=e=>{c.Engine.instance.tick(e)},F=()=>{c.Engine.instance.render()},W=()=>(X(q,0),T(F),Object(s.useEffect)((()=>(c.EntityManager.instance.createEntity().add(new v),c.EntityManager.instance.createEntity().add(new Q(window.innerWidth,window.innerHeight,10)),c.Engine.instance.createSystem(k),c.Engine.instance.createSystem(R),c.Engine.instance.createSystem(m),c.Engine.instance.createSystem(b),c.Engine.instance.createSystem(V),c.Engine.instance.createSystem(C),c.Engine.instance.createSystem(j),c.Engine.instance.createSystem(O),c.Engine.instance.createSystem(E),()=>{c.Engine.instance.systems.forEach((e=>{c.Engine.instance.unregisterSystem(e)})),c.EntityManager.instance.entities.forEach((e=>{c.EntityManager.instance.removeEntity(e.id)}))})),[]),null);n(7);const A=function(){return Object(x.jsx)("div",{className:"ui bottom",children:"TEST UI"})};const D=()=>{c.EntityManager.instance.createEntity().addComponent(new U)},N=function(){const[e,t]=i.a.useState(1),n=(e,t)=>{let n=parseFloat((e+t).toFixed(1));n<=0?n=.1:n>10&&(n=10);return c.EntityManager.instance.createEntity().addComponent(new z(n)),n},[s,a]=i.a.useState(!1);return Object(x.jsxs)("div",{className:"ui top",children:[Object(x.jsx)("div",{children:"left"}),Object(x.jsxs)("div",{children:[Object(x.jsx)("button",{type:"button",onClick:D,children:"clear"}),s?Object(x.jsx)("button",{type:"button",onClick:()=>{c.EntityManager.instance.createEntity().addComponent(new B),a(!1)},children:"play"}):Object(x.jsx)("button",{type:"button",onClick:()=>{c.EntityManager.instance.createEntity().addComponent(new Y),a(!0)},children:"pause"}),Object(x.jsx)("button",{type:"button",onClick:()=>{t((e=>n(e,-1)))},children:"<<"}),Object(x.jsx)("button",{type:"button",onClick:()=>{t((e=>n(e,-.1)))},children:"<"}),e,"x"," ",Object(x.jsx)("button",{type:"button",onClick:()=>{t((e=>n(e,.1)))},children:">"}),Object(x.jsx)("button",{type:"button",onClick:()=>{t((e=>n(e,1)))},children:">>"}),Object(x.jsx)("small",{children:Object(x.jsxs)("i",{children:["(updates every ~",Math.floor(100/e),"ms)"]})})]}),Object(x.jsx)("div",{children:"right"})]})};var H=function(){return W(),Object(x.jsxs)("div",{className:"App",children:[Object(x.jsx)(p,{}),Object(x.jsx)(N,{}),Object(x.jsx)(A,{})]})};var L=e=>{e&&e instanceof Function&&n.e(3).then(n.bind(null,30)).then((t=>{let{getCLS:n,getFID:s,getFCP:i,getLCP:a,getTTFB:r}=t;n(e),s(e),i(e),a(e),r(e)}))};r.a.render(Object(x.jsx)(i.a.StrictMode,{children:Object(x.jsx)(H,{})}),document.getElementById("root")),L()},7:function(e,t,n){}},[[29,1,2]]]);
//# sourceMappingURL=main.00fd45cc.chunk.js.map